# RPG演習プロジェクト ゲーム仕様書 (AI向け説明資料)

このドキュメントは、本プロジェクトのゲーム内容、ルール、システム構造を他のAIアシスタントや開発者が理解できるようにまとめたものです。

## 1. ゲーム概要
*   **ジャンル**: テキストベースのコマンド選択式RPG (PvE + PvP)
*   **プレイ人数**: 1人 (対戦相手3人はCPUまたは手動操作のNPC)
*   **プラットフォーム**: Python 3 (コンソールアプリケーション)
*   **データベース**: PostgreSQL (推奨) または SQLite (フォールバック)

## 2. ゲームの流れ (Game Loop)
ゲームは以下のフェーズを3回繰り返す構成になっています。

1.  **初期化フェーズ**
    *   ゲーム開始時に全データをリセット。
    *   プレイヤー名入力。
    *   初期ボーナス選択:
        1.  経験値+100 (即レベルアップ)
        2.  神の加護 (毎ターンHP+10自動回復)
        3.  [デバッグ] 最強セット (LvUP + 全アイテム付与)

2.  **ラウンド進行 (全3ラウンド)**
    *   **PvEフェーズ (ファーム)**:
        *   モンスター (スライム〜魔王の影) を選択して戦闘。
        *   勝利すると経験値と「PvP用アイテム」を確率でドロップ。
        *   このフェーズでキャラクターを強化し、アイテムを集めるのが目的。
    *   **PvPフェーズ (バトルロイヤル)**:
        *   プレイヤー1人 + NPC3人の計4人でバトルロイヤル。
        *   PvEで獲得したアイテムを使用し、ステータス (攻撃・防御・素早さ・スコア倍率) を強化して戦う。
        *   生き残った順位に応じてスコア (100pt, 60pt, 30pt, 10pt) が加算される。
        *   1位のプレイヤーには「懸賞金 (Bounty)」がかけられ、次戦で倒したプレイヤーにボーナスが入る。
    *   **敗者救済**:
        *   ラウンド終了時、下位2名のプレイヤーにランダムで支援物資が配布される。

3.  **結果発表**
    *   3ラウンド終了時点の合計スコアで最終順位を決定。

## 3. システム詳細

### 3.1 ステータス管理
データベース (`players` テーブル) で管理されます。
*   **HP/MP**: 体力と魔力。0になると脱落。
*   **EXP/Level**: 経験値100ごとにレベルアップ。攻撃力 = 10 + (Lv * 5)。
*   **Agility**: 行動順を決定する素早さ。
*   **Score**: 勝利点の累積。
*   **Bounty**: 懸賞金。連勝しているプレイヤーを倒すとボーナス。

### 3.2 戦闘システム
*   **ターン制**: Agilityの高い順に行動。
*   **コマンド**:
    *   通常攻撃
    *   スキル (MP消費): 全力斬り, ヒール, ファイア, ブリザード(氷結), ポイズン(毒), スタン撃ち(気絶), 隠れ身(隠密) など。
*   **状態異常**:
    *   氷結/気絶: 行動不能。
    *   毒: 毎ターンダメージ。
    *   隠密: 敵の攻撃対象にならない。

### 3.3 アイテムシステム
*   **PvPアイテム**: PvP開始時に自動または任意で使用。そのバトル中のみステータスを底上げする。
    *   剣 (攻撃力UP), 盾 (防御力UP), ブーツ (素早さUP), 指輪 (スコア倍率UP)
*   **PvEアイテム**: PvEフェーズで使用。回復や経験値ブーストなど。
*   **神の加護**: 特殊アイテム。所持しているだけで毎ターンHPが回復するパッシブ効果。

## 4. ファイル構成
*   `main.py`: エントリーポイント。初期化とゲームループの起動。
*   `game_manager.py`: ゲーム全体の進行管理 (PvE→PvP→結果)。
*   `db_manager.py`: データベース操作の抽象化レイヤー。
*   `pve_system.py`: PvE (対モンスター戦) のロジック。
*   `pvp_system.py`: PvP (対人戦) のロジック。現在は手動操作 (Hotseat) モードで実装。
*   `models.py`: プレイヤーやモンスターのデータクラス。
*   `config.py`: DB接続設定など。

## 5. データベーススキーマ (主要テーブル)
*   `players`: プレイヤーのステータス。
*   `items`: アイテムのマスターデータ。
*   `player_items`: プレイヤーの所持アイテム。
*   `skills`: スキルのマスターデータ。
*   `learned_skills`: プレイヤーが習得したスキル。
*   `pvp_results`: 各バトルのスコア履歴。

## 6. 開発・テスト環境
*   **言語**: Python 3
*   **DB**: PostgreSQL (本番想定) / SQLite (開発用フォールバック)
*   **テスト**: `main.py` を実行することで、対話形式でゲームフローを確認可能。現在は全プレイヤーを手動操作するデバッグモードになっている。
